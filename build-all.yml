---
  - hosts: localhost
    # connection: local
    gather_facts: yes

    tasks:
      - name: "build-all: Include variables"
        include_vars: ubuntu_1804.yml

      - name: "build-all:Create virtualbox-ubuntu_1804_xy"
        debug:
          var: "{{item}}"
          verbosity: 1
        with_items: "{{ubuntu_1804}}"
      - name: Ensure directories exists
        file:
          path: "{{item}}"
          state: directory
        with_items:
          - builds
          - builds-config

      - name: "build-all: Ensure builds-config/version exists"
        file:
          path: builds-config/version
          state: touch

      - name: "build-all: Ensure builds-config/version for pre_box exists"
        file:
          path: "builds-config/version-{{item.dependencies.box_lts}}"
          state: touch
        with_items: "{{ubuntu_1804}}"

      - include_tasks: build.yml
        BASE: "ubuntu_1804_{{item.name}}"
        box_developer: "{{item.dependencies.box_developer}}"
        box_organization: "{{item.box_organization | default ('kraeml')}}"
        box_lts: "{{item.dependencies.box_lts}}"
        box_version: "{{item.dependencies.box_version | default (lookup('file', 'builds-config/version-{{box_lts}}'))}}"
        box_name: "{{box_organization}}/ubuntu_1804_{{item.name}}"
        requirements: "ansible/{{item.dependencies.requirements}}"
        playbook: "ansible/{{item.dependencies.playbook}}"
        # Used later in box_ovf_path
        box_ovf_default: "{{ovf_path}}file:-VAGRANTSLASH--VAGRANTSLASH-builds-VAGRANTSLASH-virtualbox-{{item.dependencies.box_lts}}.box/0/virtualbox/"
        box_ovf_path: "{{item.dependencies.box_ovf_path | default (box_ovf_default)}}"
        with_items: "{{ubuntu_1804}}"
        #environment:
        #  http_proxy: "{{ansible_default_ipv4.address}}:8888"
