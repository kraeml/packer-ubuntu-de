---
  - hosts: localhost
    connection: local
    gather_facts: yes
    vars:
      ovf_path: "{{ansible_user_dir}}/.vagrant.d/boxes/"
      ubuntu_1804:
        - name: de
          dependencies:
            box_developer: "geerlingguy"
            box_lts: "ubuntu1804"
            box_version: "1.0.1"
            box_ovf_path: "{{ovf_path}}geerlingguy-VAGRANTSLASH-ubuntu1804/1.0.1/virtualbox/"
            requirements: "requirements-ubuntu_1804_de.yml"
            playbook: "main-ubuntu_1804_de.yml"
        - name: de_jupyter
          dependencies:
            box_developer: "kraeml"
            box_lts: "ubuntu_1804_de"
            box_version: "{{lookup('file', 'version-ubuntu_1804_de') }}"
            requirements: "requirements-ubuntu_1804_de_jupyter.yml"
            playbook: "main-ubuntu_1804_de_jupyter.yml"
            # box_ovf_path: "file:-VAGRANTSLASH--VAGRANTSLASH-builds-VAGRANTSLASH-virtualbox-ubuntu_1804_de.box/0/virtualbox/"


    tasks:
      - name: Create virtualbox-ubuntu_1804_xy
        debug:
          var: "{{item}}"
          verbosity: 1
        with_items: "{{ubuntu_1804}}"

      - include_tasks: build.yml
        BASE: "ubuntu_1804_{{item.name}}"
        box_developer: "{{item.dependencies.box_developer}}"
        box_organization: "{{item.box_organization | default ('kraeml')}}"
        box_lts: "{{item.dependencies.box_lts}}"
        box_version: "{{item.dependencies.box_version}}"
        box_name: "{{box_organization}}/ubuntu_1804_{{item.name}}"
        requirements: "ansible/{{item.dependencies.requirements}}"
        playbook: "ansible/{{item.dependencies.playbook}}"
        # Used later in box_ovf_path
        box_ovf_default: "{{ovf_path}}file:-VAGRANTSLASH--VAGRANTSLASH-builds-VAGRANTSLASH-virtualbox-{{item.dependencies.box_lts}}.box/0/virtualbox/"
        box_ovf_path: "{{item.dependencies.box_ovf_path | default (box_ovf_default)}}"
        with_items: "{{ubuntu_1804}}"
