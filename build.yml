- name: Start build info
  debug:
    msg: Build Box {{BASE}} depends on {{box_developer}}/{{box_lts}} in version {{box_version}}
    verbosity: 1

- include_tasks: check_box_tasks.yml

- name: "build: ToDo skript is often here. Could be better"
  make:
    chdir: ./
    target: no-cloud

- name: "build: Create Vagrantfile-{{BASE}}"
  template:
    dest: "builds/Vagrantfile-{{BASE}}"
    src: templates/Vagrantfile-ubuntu_1804_de.j2

- name: "build: build {{BASE}}"
  # Use BASE NOT box_name! The name box_name is double.
  shell: >
    packer build -force
    -var "box_name={{BASE}}"
    -var "box_organization={{box_organization}}"
    -var "requirements={{requirements}}"
    -var "playbook={{playbook}}"
    packer-ubuntu_1804_de-no-cloud.json
  args:
    executable: /bin/bash
    chdir: ./
  environment:
    PACKER_LOG: 1
    PACKER_LOG_PATH: ./log/packer.log
